#!/usr/bin/env python
import scapy.all as scapy
import optparse

def args_opt():
    parser = optparse.OptionParser()
    parser.add_option("-t", "--target", dest="target", help="put an ip and range")
    (values, argus) = parser.parse_args()
    return  values.target

def scan(ip):
    arp_request = scapy.ARP(pdst=ip)
    broadcast = scapy.Ether(dst="ff:ff:ff:ff:ff:ff")
    arp_request_broad = arp_request/broadcast
    answered = scapy.srp(arp_request_broad, timeout=1, verbose=False)[0]
    c_list = []
    for each_answered in answered:
        dict = {"IP": each_answered[1].psrc(), "MAC": each_answered[1].hwsrc()}
        c_list.append(dict)
    print(c_list)

def print_res(result):
    print("IP\t\t\tMAC ADDRESS\n")
    for client in result:
        print(client["ip"] + "\t" + client["mac"])

args = args_opt()
scan_res = scan(args)
print(scan_res)
